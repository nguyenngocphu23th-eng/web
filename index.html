<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web H·∫πn H√≤ - LoveConnect</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #f45b69; /* ƒê·ªè h·ªìng */
            --secondary-color: #ff9aa2; /* H·ªìng nh·∫°t */
            --bg-color: #fcf4f5; /* N·ªÅn tr·∫Øng h·ªìng */
            --heart-color: #d83a48;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            --transition-time: 0.4s;
            --text-color: #333;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Hi·ªáu ·ª©ng n·ªÅn */
        .heart-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; overflow: hidden; z-index: -1;
            background: radial-gradient(circle at top right, #fce4ec 0%, #ffcdd2 100%);
        }
        .heart {
            position: absolute; font-size: 28px; color: var(--heart-color);
            opacity: 0.7; text-shadow: 0 0 5px rgba(244, 91, 105, 0.6);
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg) scale(1.2); opacity: 0.9; }
            100% { transform: translateY(100vh) rotate(360deg) scale(0.6); opacity: 0; }
        }
        
        /* --- Header v√† Navigation --- */
        header {
            background-color: var(--primary-color);
            color: white; padding: 15px 40px;
            box-shadow: var(--shadow); display: flex;
            justify-content: space-between; align-items: center; z-index: 100;
        }
        header h1 { margin: 0; font-size: 32px; letter-spacing: 2px; text-shadow: 1px 1px 3px rgba(0,0,0,0.15); }

        nav a {
            color: white; text-decoration: none; padding: 10px 22px;
            margin-left: 12px; border-radius: 28px;
            transition: all var(--transition-time) ease; font-weight: 500;
        }
        nav a:hover {
            background-color: #d64a58;
            transform: scale(1.08);
        }

        .container {
            max-width: 1400px; margin: 30px auto; padding: 40px;
            background-color: white; border-radius: 25px;
            box-shadow: var(--shadow); min-height: 75vh;
        }
        
        /* --- Forms & Inputs --- */
        .auth-form, .profile-form {
            max-width: 580px; margin: 60px auto; padding: 50px;
            border: 3px solid var(--secondary-color); border-radius: 20px;
            text-align: center; background-color: #fffafa;
        }
        input[type="text"], input[type="password"], input[type="email"], textarea, select, input[type="file"], input[type="date"] {
            width: calc(100% - 24px); padding: 14px; margin: 12px 0;
            border: 1px solid #ddd; border-radius: 10px;
            box-sizing: border-box; font-size: 17px;
        }
        button {
            background-color: var(--primary-color); color: white;
            padding: 15px 35px; border: none; border-radius: 30px;
            cursor: pointer; transition: all var(--transition-time);
            font-weight: 600; margin-top: 20px; font-size: 18px;
        }
        button:hover {
            background-color: #d64a58;
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Home & Profile */
        .home-section { display: flex; gap: 40px; margin-top: 30px; }
        .profile-card, .friend-list-panel {
            padding: 30px; border: 1px solid #ffcdd2;
            border-radius: 20px; background-color: #fff8f9;
        }
        .profile-card { flex: 1.5; text-align: center; }
        .friend-list-panel { flex: 2.5; }
        .friend-item {
            display: flex; align-items: center; padding: 18px 0; border-bottom: 1px dashed #ffcdd2;
            cursor: pointer; transition: background-color 0.2s;
        }
        .friend-item:hover { background-color: #fef0f2; }
        .friend-avatar { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; margin-right: 20px; }
        
        .profile-photo-container {
            position: relative; width: 220px; height: 220px; margin: 0 auto 30px;
        }
        #profile-photo-display {
            width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
            border: 5px solid var(--secondary-color);
        }
        .upload-button {
            position: absolute; bottom: 0; right: 0; width: 45px; height: 45px;
            border-radius: 50%; background-color: var(--primary-color); color: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 20px; line-height: 1;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* Chat */
        .chat-container { display: flex; height: 650px; border: 1px solid #ffcdd2; border-radius: 15px; }
        .chat-sidebar { flex-basis: 250px; border-right: 1px solid #ffcdd2; background-color: #fef8f8; padding: 10px; }
        .chat-area { flex-grow: 1; display: flex; flex-direction: column; }
        .messages { flex-grow: 1; padding: 20px; overflow-y: auto; background-color: #fafafa; }
        .message-input { padding: 20px; border-top: 1px solid #ffcdd2; display: flex; gap: 15px; align-items: center; }
        .message-input input[type="text"] { flex-grow: 1; padding: 12px; border-radius: 25px; }
        .message-bubble {
            max-width: 60%; padding: 15px 20px; border-radius: 25px; margin-bottom: 15px;
            word-wrap: break-word; /* ƒê·∫£m b·∫£o tin nh·∫Øn d√†i kh√¥ng tr√†n ra ngo√†i */
        }
        .sent { background-color: var(--primary-color); color: white; margin-left: auto; }
        .received { background-color: #e0f7fa; color: var(--text-color); margin-right: auto; }
        
        /* Countdown/K·ª∑ Ni·ªám */
        .countdown-container {
            padding: 30px; text-align: center; border: 2px solid var(--primary-color);
            border-radius: 20px; background-color: #fff; max-width: 700px; margin: 30px auto;
        }
        .romantic-font { font-family: 'Pacifico', cursive; color: var(--primary-color); }
        .days-count-display { 
            font-size: 4rem; font-weight: bold; color: var(--heart-color); margin: 20px 0;
            display: block; line-height: 1;
        }
        .milestone-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 0; border-bottom: 1px dashed #eee;
        }
        .milestone-date { font-weight: 600; color: #5a5a5a; }
        .milestone-status { padding: 5px 10px; border-radius: 15px; font-size: 0.9em; }
        .status-upcoming { background-color: #ffe0b2; color: #ff9800; }
        .status-passed { background-color: #c8e6c9; color: #4caf50; }
        .status-today { background-color: #ffcdd2; color: var(--primary-color); font-weight: bold; }

        /* Th√™m style cho √¥ game Tic-Tac-Toe */
        .cell {
            width: 100px; height: 100px; 
            border: 2px solid var(--secondary-color); 
            display: flex; justify-content: center; align-items: center;
            font-size: 4rem; font-weight: 700;
            cursor: pointer; transition: background-color 0.2s;
            color: var(--primary-color);
        }
        .cell:hover:not(.x):not(.o) {
            background-color: #ffebee;
        }
        .x {
            color: var(--primary-color); /* ƒê·ªè */
        }
        .o {
            color: #4CAF50; /* Xanh l√° */
        }
        .cell:nth-child(3n) { border-right: none; }
        .cell:nth-child(n+7) { border-bottom: none; }
        .cell:nth-child(3n+1) { border-left: none; }
        .cell:nth-child(-n+3) { border-top: none; }

        /* --- Style cho ph·∫ßn game m·ªõi --- */
        .game-menu {
            display: flex; justify-content: center; gap: 10px; margin-bottom: 30px;
            flex-wrap: wrap; /* Cho ph√©p menu xu·ªëng d√≤ng n·∫øu qu√° d√†i */
        }
        .game-menu button {
            padding: 12px 25px; font-size: 14px; margin: 5px 0;
            background-color: var(--secondary-color); color: var(--text-color);
            border: 2px solid var(--primary-color);
            transition: background-color 0.3s, transform 0.3s;
        }
        .game-menu button.active {
            background-color: var(--primary-color); color: white;
            transform: scale(1.05);
        }
        .game-panel {
            border: 3px dashed var(--secondary-color); border-radius: 15px;
            padding: 30px; max-width: 850px; margin: 20px auto;
            background-color: #fffafa; text-align: center;
            min-height: 400px;
        }

        /* Style cho Tr√≤ 1: V√≤ng quay T√¨nh Y√™u */
        #spinner {
            width: 250px; height: 250px; border-radius: 50%; background: conic-gradient(
                #ffcdd2 0 45deg, #f8bbd0 0 90deg, #e1bee7 0 135deg, #c8e6c9 0 180deg, 
                #b2ebf2 0 225deg, #ffcdd2 0 270deg, #f8bbd0 0 315deg, #e1bee7 0 360deg
            );
            margin: 30px auto; position: relative;
            box-shadow: 0 0 15px rgba(244, 91, 105, 0.5);
            transition: transform 5s cubic-bezier(0.1, 0.9, 0.4, 1);
        }
        .pointer {
            width: 0; height: 0; border-left: 15px solid transparent;
            border-right: 15px solid transparent; border-bottom: 30px solid var(--heart-color);
            position: absolute; top: -10px; left: calc(50% - 15px); z-index: 10;
        }
        #spinner-result {
            font-size: 1.2rem; font-weight: 600; color: var(--text-color); margin-top: 20px;
            padding: 15px; border-radius: 10px; background-color: #fce4ec;
        }

        /* Style cho Tr√≤ 3: L·∫≠t Th·∫ª K·ª∑ Ni·ªám */
        #memory-board {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;
            width: 440px; margin: 20px auto;
        }
        .memory-card {
            width: 100px; height: 100px; background-color: var(--secondary-color);
            border-radius: 10px; cursor: pointer; display: flex;
            justify-content: center; align-items: center; font-size: 2.5rem;
            color: white; transform-style: preserve-3d; transition: transform 0.5s;
            position: relative;
        }
        .memory-card.flipped {
            transform: rotateY(180deg);
        }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; display: flex; justify-content: center; align-items: center;
            border-radius: 10px;
        }
        .card-front {
            background-color: var(--secondary-color);
            color: white; font-size: 1.2rem;
            transform: rotateY(0deg);
        }
        .card-back {
            background-color: var(--primary-color);
            color: white;
            transform: rotateY(180deg);
        }
        .memory-card.matched .card-back {
            background-color: #4CAF50; /* Xanh l√° khi kh·ªõp */
        }
        
        /* Style cho Tr√≤ 5: H·ªôp H·ªèi ƒê√°p */
        #qa-box {
            max-width: 500px; margin: 30px auto; padding: 25px;
            border: 3px solid #ffcdd2; border-radius: 15px;
            background-color: #fef5f6;
        }
        #answer-display {
            min-height: 80px; padding: 15px; border: 1px dashed var(--primary-color);
            margin-top: 20px; font-size: 1.1rem; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-color); background-color: white;
        }
        #qa-input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            border-radius: 8px; border: 1px solid #ddd;
            box-sizing: border-box;
        }

        /* Style cho Tr√≤ 6: X·∫øp H√¨nh Tr√°i Tim */
        #jigsaw-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            width: 306px; /* 100px*3 + 5px*2 */
            margin: 20px auto;
        }
        .jigsaw-piece {
            width: 100px; height: 100px;
            background-color: #fce4ec;
            border: 1px solid var(--secondary-color);
            cursor: pointer;
            font-size: 3rem;
            display: flex; justify-content: center; align-items: center;
            color: var(--heart-color);
            transition: transform 0.2s, opacity 0.2s;
        }
        .jigsaw-piece.solved {
            opacity: 0.8;
            transform: scale(1.05);
            background-color: #c8e6c9;
        }
        .jigsaw-piece.selected {
            border: 4px solid var(--primary-color);
            transform: scale(1.1);
        }
        .jigsaw-piece:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body onload="checkLoginStatus()">
    <div class="heart-background" id="heart-bg"></div>

    <header>
        <h1>LoveConnect ‚ù§Ô∏è</h1>
        <nav id="main-nav" style="display: none;">
            <a href="#" onclick="showSection('home')">Trang Ch·ªß</a>
            <a href="#" onclick="showSection('profile')">H·ªì S∆°</a>
            <a href="#" onclick="showSection('chat')">Nh·∫Øn Tin</a>
            <a href="#" onclick="showSection('game')">Tr√≤ Ch∆°i</a>
            <a href="#" onclick="showSection('remind')">K·ª∑ Ni·ªám</a>
            <a href="#" onclick="logout()">ƒêƒÉng Xu·∫•t</a>
        </nav>
    </header>

    <section id="auth-section" class="auth-form" style="display: none;">
        <div id="login-form">
            <h2>ƒêƒÉng Nh·∫≠p</h2>
            <input type="email" id="login-email" placeholder="Email" required>
            <input type="password" id="login-password" placeholder="M·∫≠t kh·∫©u" required>
            <div style="text-align: left; margin-top: 10px;">
                <input type="checkbox" id="remember-me"> 
                <label for="remember-me">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</label>
            </div>
            <button onclick="handleLogin()">ƒêƒÉng Nh·∫≠p</button>
            <p style="margin-top: 20px;">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" onclick="toggleAuthForm(true)">ƒêƒÉng K√Ω</a></p>
        </div>
        <div id="register-form" style="display: none;">
            <h2>ƒêƒÉng K√Ω T√†i Kho·∫£n</h2>
            <input type="text" placeholder="T√™n ng∆∞·ªùi d√πng" required>
            <input type="email" placeholder="Email" required>
            <input type="password" placeholder="M·∫≠t kh·∫©u" required>
            <button onclick="handleRegister()">ƒêƒÉng K√Ω</button>
            <p style="margin-top: 20px;">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="toggleAuthForm(false)">ƒêƒÉng Nh·∫≠p</a></p>
        </div>
    </section>

    <section id="home" class="container" style="display: none;">
        <h2>T√¨m ki·∫øm T√¨nh Y√™u c·ªßa b·∫°n! ‚ú®</h2>
        <h3 id="days-together" style="color: var(--heart-color); text-align: center;"></h3>
        <div class="home-section">
            <div class="profile-card">
                <h3>H·ªì S∆° C·ªßa B·∫°n</h3>
                <img id="home-avatar" src="https://via.placeholder.com/220/FF80AB/FFFFFF?text=YOU" alt="Avatar">
                <h4 id="home-user-name">Ng∆∞·ªùi d√πng A-25</h4>
                <p id="home-user-hometown">Qu√™ qu√°n: H√† N·ªôi</p>
                <p id="home-user-hobby">S·ªü th√≠ch: Du l·ªãch, Ch·ª•p ·∫£nh</p>
                <button onclick="showSection('profile')">Ch·ªânh s·ª≠a H·ªì s∆°</button>
            </div>
            <div class="friend-list-panel">
                <h3>Danh S√°ch K·∫øt N·ªëi (1)</h3>
                <div class="friend-list">
                    <div class="friend-item" onclick="openChat('B')">
                        <img class="friend-avatar" src="https://via.placeholder.com/70/FFC1E3/FFFFFF?text=B" alt="B">
                        <div>
                            <strong>H·ªá th·ªëng </strong> 
                            <span style="color: green; font-size: 14px;">‚Ä¢ Tr·ª±c tuy·∫øn</span>
                            <p style="font-size: 12px; margin: 0;"> </p>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 30px; text-align: center;">
                    <button>T√¨m ki·∫øm ng∆∞·ªùi ph√π h·ª£p</button>
                </div>
            </div>
        </div>
    </section>

    <section id="profile" class="container" style="display: none;">
        <h2>Ch·ªânh S·ª≠a H·ªì S∆° C√° Nh√¢n</h2>
        <form class="profile-form">
            <div class="profile-photo-container">
                <img id="profile-photo-display" src="https://via.placeholder.com/220/FF80AB/FFFFFF?text=YOU" alt="·∫¢nh H·ªì s∆°">
                <label class="upload-button" for="profile-photo-upload">
                    ‚ûï
                    <input type="file" id="profile-photo-upload" accept="image/*" onchange="previewPhoto(event)">
                </label>
            </div>
            
            <label for="p-name">T√™n-Tu·ªïi:</label>
            <input type="text" id="p-name" value="Ng∆∞·ªùi d√πng A-25">
            
            <label for="p-hometown">Qu√™ Qu√°n:</label>
            <input type="text" id="p-hometown" value="H√† N·ªôi">

            <label for="p-hobby">S·ªü Th√≠ch:</label>
            <input type="text" id="p-hobby" value="Du l·ªãch, ch·ª•p ·∫£nh, n·∫•u ƒÉn">
            
            <button type="button" onclick="saveProfile()">L∆∞u H·ªì S∆°</button>
        </form>
    </section>

    <section id="chat" class="container" style="display: none;">
        <h2>Khung Chat Ri√™ng T∆∞ üí¨</h2>
        <div class="chat-container">
            <div class="chat-sidebar">
                <h4 style="padding: 10px; margin: 0; color: var(--primary-color);">K·∫øt n·ªëi g·∫ßn ƒë√¢y</h4>
                <div class="friend-item" onclick="selectChat('B')">H·ªá  th·ªëng</div>
            </div>
            <div class="chat-area">
                <h4 style="padding: 15px; border-bottom: 1px solid #eee;" id="chat-header">ƒêang tr√≤ chuy·ªán v·ªõi **Ng∆∞·ªùi d√πng B**</h4>
                <div class="messages" id="messages-area">
                    <div class="message-bubble received">Ch√†o b·∫°n ƒë·∫øn v·ªõi trang web.</div>
                </div>
                <div class="message-input">
                    <input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn (Th·∫£ icon: :love:, :smile:)..."
                                onkeypress="if(event.keyCode === 13) sendChat()">
                    <button style="background-color: #4CAF50; margin: 0; padding: 12px; border-radius: 50%; font-size: 22px;" 
                                onclick="attachPhoto()">üì∑</button>
                    <button onclick="sendChat()" style="padding: 12px 25px; margin-top: 0; border-radius: 25px;">G·ª≠i</button>
                </div>
            </div>
        </div>
    </section>
    
    <section id="game" class="container" style="display: none;">
        <h2>Tr√≤ Ch∆°i K·∫øt N·ªëi T√¨nh Y√™u ‚ù§Ô∏èüéÆ</h2>
        
        <div class="game-menu">
            <button id="btn-tictactoe" onclick="showGame('tictactoe')">Tic-Tac-Toe</button>
            <button id="btn-spinner" onclick="showGame('spinner-game')">V√≤ng quay T√¨nh Y√™u</button>
            <button id="btn-guess" onclick="showGame('guess-word')">ƒêo√°n √ù ƒê·ªìng ƒê·ªôi</button>
            <button id="btn-memory" onclick="showGame('memory-match')">L·∫≠t Th·∫ª K·ª∑ Ni·ªám</button>
            <button id="btn-dice" onclick="showGame('date-dice')">X√∫c X·∫Øc H·∫πn H√≤</button>
            <button id="btn-qa" onclick="showGame('qa-box-game')">H·ªôp H·ªèi ƒê√°p</button>
            <button id="btn-jigsaw" onclick="showGame('jigsaw-game')">X·∫øp H√¨nh Tr√°i Tim</button>
        </div>

        <div id="tictactoe" class="game-panel" style="display: none;">
            <h3>Tic-Tac-Toe C·ªï ƒêi·ªÉn</h3>
            <div style="text-align: center; margin-bottom: 25px;">
                <h4 id="tictactoe-status" style="color: var(--primary-color);">L∆∞·ª£t c·ªßa Ng∆∞·ªùi ch∆°i X</h4>
            </div>
            
            <div style="display: flex; justify-content: center; align-items: flex-start; gap: 40px;">
                <div id="tic-tac-toe-board" style="display: grid; grid-template-columns: repeat(3, 100px); grid-template-rows: repeat(3, 100px); border: 4px solid var(--primary-color); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(244, 91, 105, 0.4);">
                </div>
                <div style="padding: 20px; border: 1px solid var(--secondary-color); border-radius: 10px; background-color: #fff8f9; width: 200px;">
                    <h4>B·∫£ng ƒêi·ªÉm</h4>
                    <p>Ng∆∞·ªùi ch∆°i X (B·∫°n): <span id="score-x" style="font-weight: bold; color: #d83a48;">0</span></p>
                    <p>Ng∆∞·ªùi ch∆°i O (Partner): <span id="score-o" style="font-weight: bold; color: #4CAF50;">0</span></p>
                    <button onclick="resetGame(true)" style="background-color: #6c757d; width: 100%; padding: 10px; margin-top: 15px;">Ch∆°i L·∫°i (Reset ƒêi·ªÉm)</button>
                </div>
            </div>
        </div>
        
        <div id="spinner-game" class="game-panel" style="display: none;">
            <h3>V√≤ng Quay T√¨nh Y√™u üé°</h3>
            <p>Quay ƒë·ªÉ nh·∫≠n m·ªôt nhi·ªám v·ª• ho·∫∑c c√¢u h·ªèi l√£ng m·∫°n.</p>
            <div class="pointer"></div>
            <div id="spinner"></div>
            <button onclick="spinWheel()">Quay Ngay!</button>
            <div id="spinner-result">B·∫•m 'Quay Ngay!' ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div>
        </div>
        
        <div id="guess-word" class="game-panel" style="display: none;">
            <h3>ƒêo√°n √ù ƒê·ªìng ƒê·ªôi üí°</h3>
            <p id="guess-status">Ng∆∞·ªùi ch∆°i 1 (B·∫°n) - ƒê·∫∑t t·ª´ b√≠ m·∫≠t.</p>
            <input type="text" id="secret-word-input" placeholder="Nh·∫≠p t·ª´ b√≠ m·∫≠t (VD: N·ª• h√¥n)">
            <button onclick="setSecretWord()">ƒê·∫∑t T·ª´</button>
            <div id="guesser-controls" style="display: none; margin-top: 20px;">
                <p>Ng∆∞·ªùi ch∆°i 2 (Partner) - ƒêo√°n t·ª´ c√≥ <span id="word-length">X</span> ch·ªØ c√°i.</p>
                <input type="text" id="guess-input" placeholder="Nh·∫≠p c√¢u tr·∫£ l·ªùi">
                <button onclick="checkGuess()">ƒêo√°n</button>
                <p id="guess-feedback" style="margin-top: 15px; font-weight: bold;"></p>
            </div>
            <button id="reset-guess" onclick="resetGuessGame()" style="display: none; background-color: #6c757d;">Ch∆°i L·∫°i</button>
        </div>
        
        <div id="memory-match" class="game-panel" style="display: none;">
            <h3>L·∫≠t Th·∫ª K·ª∑ Ni·ªám üÉè</h3>
            <p>T√¨m c√°c c·∫∑p th·∫ª gi·ªëng nhau ƒë·ªÉ ghi nh·ªõ kho·∫£nh kh·∫Øc ng·ªçt ng√†o!</p>
            <div id="memory-board"></div>
            <p style="margin-top: 20px;">S·ªë l·∫ßn l·∫≠t: <span id="memory-flips">0</span> | C·∫∑p ƒë√£ t√¨m: <span id="memory-matched">0</span></p>
            <button onclick="initializeMemoryGame()" style="background-color: #6c757d;">Ch∆°i L·∫°i</button>
        </div>
        
        <div id="date-dice" class="game-panel" style="display: none;">
            <h3>X√∫c X·∫Øc Quy·∫øt ƒê·ªãnh H·∫πn H√≤ üé≤</h3>
            <p>Tung x√∫c x·∫Øc ƒë·ªÉ ch·ªçn ho·∫°t ƒë·ªông cho bu·ªïi h·∫πn h√≤ ti·∫øp theo!</p>
            <div id="dice-display" style="font-size: 5rem; color: var(--primary-color); margin: 30px 0;">?</div>
            <button onclick="rollDice()">Tung X√∫c X·∫Øc</button>
            <div id="dice-result" style="margin-top: 20px; font-size: 1.3rem; font-weight: 600;"></div>
        </div>

        <div id="qa-box-game" class="game-panel" style="display: none;">
            <h3>H·ªôp H·ªèi ƒê√°p T√¨nh Y√™u üîÆ</h3>
            <p>ƒê·∫∑t m·ªôt c√¢u h·ªèi v·ªÅ t√¨nh y√™u, v√† nh·∫≠n ƒë∆∞·ª£c c√¢u tr·∫£ l·ªùi ng·∫´u nhi√™n t·ª´ v≈© tr·ª•!</p>
            
            <div id="qa-box">
                <input type="text" id="qa-input" placeholder="B·∫°n mu·ªën h·ªèi g√¨ v·ªÅ t√¨nh y√™u? (VD: Ch√∫ng ta c√≥ h·ª£p nhau kh√¥ng?)">
                <button onclick="getLoveAnswer()">Nh·∫≠n C√¢u Tr·∫£ L·ªùi</button>
                <div id="answer-display">
                    C√¢u tr·∫£ l·ªùi s·∫Ω hi·ªán ·ªü ƒë√¢y.
                </div>
            </div>
        </div>

        <div id="jigsaw-game" class="game-panel" style="display: none;">
            <h3>X·∫øp H√¨nh Tr√°i Tim üß©</h3>
            <p>S·∫Øp x·∫øp c√°c m·∫£nh gh√©p ƒë·ªÉ t·∫°o th√†nh m·ªôt h√¨nh tr√°i tim ho√†n ch·ªânh (Th·ª© t·ª± 1 -> 9)!</p>
            <div id="jigsaw-board"></div>
            <p id="jigsaw-status" style="margin-top: 20px; font-weight: bold; color: var(--heart-color);">B·∫Øt ƒë·∫ßu x·∫øp h√¨nh!</p>
            <button onclick="initializeJigsawGame()">Ch∆°i L·∫°i (Tr·ªôn H√¨nh)</button>
        </div>

    </section>

    <section id="remind" class="container" style="display: none;">
        <div class="countdown-container">
            <h1 class="romantic-font" style="font-size: 2.5rem; margin-bottom: 10px;">Ng√†y Y√™u C·ªßa Ch√∫ng Ta</h1>
            <p style="color: #666; margin-bottom: 20px;">Ch√∫ng ta ƒë√£ b√™n nhau ƒë∆∞·ª£c...</p>

            <div id="days-container" class="my-8">
                <span id="days-count" class="days-count-display">0</span>
                <span style="font-size: 1.2rem; font-weight: 600; color: #777;">Ng√†y</span>
            </div>

            <div id="start-date-display" style="margin-bottom: 25px; font-size: 1.1rem; font-weight: 500;">
                Ng√†y b·∫Øt ƒë·∫ßu: <span id="start-date-text" style="color: var(--primary-color); font-weight: bold;">Ch∆∞a thi·∫øt l·∫≠p</span>
            </div>

            <h2 style="font-size: 1.5rem; color: var(--primary-color); margin-top: 30px; margin-bottom: 15px; border-top: 1px solid #f0f0f0; padding-top: 15px;">K·ª∑ Ni·ªám S·∫Øp T·ªõi</h2>
            <div id="milestones" style="text-align: left; space-y-3;">
                </div>

            <div style="margin-top: 30px; border-top: 1px solid #f0f0f0; padding-top: 20px;">
                <label for="start-date" style="display: block; color: #555; font-weight: 600; margin-bottom: 8px;">
                    Thi·∫øt l·∫≠p Ng√†y B·∫Øt ƒê·∫ßu Y√™u:
                </label>
                <input type="date" id="start-date">
                <button onclick="saveDate()" style="width: 100%; max-width: 300px;">
                    L∆∞u Ng√†y Y√™u
                </button>
            </div>
        </div>
    </section>

    <div id="message-box" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background-color: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); max-width: 350px; text-align: center;">
            <h3 id="message-title" style="color: var(--primary-color); font-size: 1.5rem; margin-bottom: 10px;">Th√¥ng b√°o</h3>
            <p id="message-content" style="color: #555; margin-bottom: 20px;"></p>
            <button onclick="hideMessage()" style="padding: 10px 20px; margin-top: 0;">ƒê√≥ng</button>
        </div>
    </div>


    <script>
        const HEARTS = ['‚ù§Ô∏è', 'üíñ', 'üíò', 'üíï', 'üíû', 'üíì', 'üíó', 'üíå', '‚ù£Ô∏è'];
        const ICONS = {
            ':love:': 'üíñ', ':kiss:': 'üòò', ':smile:': 'üòä', ':laugh:': 'üòÇ', ':cry:': 'üò¢', ':sad:': 'üòî'
        };
        const USER_KEY = 'loveconnect_user';
        const DAYS_KEY = 'loveStartDate';
        
        // --- Game Tic-Tac-Toe Variables ---
        const WINNING_COMBOS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // H√†ng ngang
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // H√†ng d·ªçc
            [0, 4, 8], [2, 4, 6]             // ƒê∆∞·ªùng ch√©o
        ];
        let board = ['', '', '', '', '', '', '', '', ''];
        let currentPlayer = 'X'; // X lu√¥n b·∫Øt ƒë·∫ßu
        let isGameActive = true;
        let scoreX = 0;
        let scoreO = 0;
        // ---------------------------------

        let connectionDate = null;
        let lastUserMessage = ""; // Bi·∫øn l∆∞u tin nh·∫Øn cu·ªëi c√πng c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ t·∫°o ng·ªØ c·∫£nh ph·∫£n h·ªìi

        // Kh·ªüi t·∫°o game khi t·∫£i trang (sau khi DOM ƒë√£ s·∫µn s√†ng)
        document.addEventListener('DOMContentLoaded', () => {
            initializeGame();
            initializeMemoryGame();
            initializeJigsawGame();
        });


        function showMessage(title, content) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-content').textContent = content;
            document.getElementById('message-box').style.display = 'flex';
        }

        function hideMessage() {
            document.getElementById('message-box').style.display = 'none';
        }

        function showSection(id) {
            document.querySelectorAll('section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(id).style.display = 'block';
            
            if (id === 'home') {
                calculateDaysTogether(); 
            } else if (id === 'remind') {
                loadDate();
            } else if (id === 'game') {
                // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã Tic-Tac-Toe khi v√†o m·ª•c Game l·∫ßn ƒë·∫ßu
                if (!document.querySelector('.game-panel:not([style*="display: none"])')) {
                    showGame('tictactoe'); 
                }
            }
        }

        function showGame(gameId) {
            // ·∫®n t·∫•t c·∫£ b·∫£ng game
            document.querySelectorAll('.game-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            // ·∫®n tr·∫°ng th√°i active c·ªßa t·∫•t c·∫£ n√∫t
            document.querySelectorAll('.game-menu button').forEach(btn => {
                btn.classList.remove('active');
            });

            // Hi·ªÉn th·ªã b·∫£ng game ƒë∆∞·ª£c ch·ªçn
            document.getElementById(gameId).style.display = 'block';
            // ƒê·∫∑t tr·∫°ng th√°i active cho n√∫t
            const btnId = gameId.replace('-game', '').replace('-box', '');
            document.getElementById(`btn-${btnId}`).classList.add('active');
            
            // Kh·ªüi t·∫°o game c·ª• th·ªÉ
            if (gameId === 'tictactoe') {
                initializeGame();
            } else if (gameId === 'memory-match') {
                initializeMemoryGame();
            } else if (gameId === 'guess-word') {
                resetGuessGame();
            } else if (gameId === 'spinner-game') {
                document.getElementById('spinner').style.transform = 'rotate(0deg)';
                document.getElementById('spinner-result').textContent = "B·∫•m 'Quay Ngay!' ƒë·ªÉ b·∫Øt ƒë·∫ßu.";
            } else if (gameId === 'date-dice') {
                document.getElementById('dice-display').textContent = '?';
                document.getElementById('dice-result').textContent = 'Ch·ªçn m·ªôt ho·∫°t ƒë·ªông l√£ng m·∫°n cho bu·ªïi h·∫πn h√≤ s·∫Øp t·ªõi!';
            } else if (gameId === 'jigsaw-game') {
                initializeJigsawGame(); // Kh·ªüi t·∫°o tr√≤ ch∆°i x·∫øp h√¨nh
            } else if (gameId === 'qa-box-game') {
                document.getElementById('answer-display').textContent = 'C√¢u tr·∫£ l·ªùi s·∫Ω hi·ªán ·ªü ƒë√¢y.';
                document.getElementById('qa-input').value = '';
            }
        }

        // --- 1. Qu·∫£n l√Ω ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω & Ghi nh·ªõ ---
        function isValidGmail(email) {
            return /^[a-zA-Z0-9._%+-]+@gmail\.com$/i.test(email);
        }

        function toggleAuthForm(isRegister) {
            document.getElementById('register-form').style.display = isRegister ? 'block' : 'none';
            document.getElementById('login-form').style.display = isRegister ? 'none' : 'block';
        }

        function handleRegister() {
            showMessage("ƒêƒÉng k√Ω th√†nh c√¥ng", "T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c t·∫°o. Vui l√≤ng ƒëƒÉng nh·∫≠p.");
            toggleAuthForm(false);
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const rememberMe = document.getElementById('remember-me').checked;

            if (email === '' || password === '') {
                showMessage("L·ªói", "Vui l√≤ng nh·∫≠p email v√† m·∫≠t kh·∫©u.");
                return;
            }

            if (!isValidGmail(email)) {
                showMessage("L·ªói", "Vui l√≤ng s·ª≠ d·ª•ng ƒë·ªãa ch·ªâ email h·ª£p l·ªá c·ªßa Gmail.");
                return;
            }
            
            if (rememberMe) {
                localStorage.setItem(USER_KEY, email);
            } else {
                localStorage.removeItem(USER_KEY);
            }
            loginSuccess(email);
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem(USER_KEY);
            if (savedUser) {
                loginSuccess(savedUser); 
            } else {
                showSection('auth-section');
                toggleAuthForm(false);
            }
        }

        function loginSuccess(email) {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('main-nav').style.display = 'flex';
            document.getElementById('home-user-name').textContent = `${email.split('@')[0]}`;
            showSection('home');
            setInterval(createHeart, 800);
        }

        function logout() {
            localStorage.removeItem(USER_KEY);
            showMessage("ƒê√£ ƒëƒÉng xu·∫•t", "B·∫°n ƒë√£ ƒëƒÉng xu·∫•t kh·ªèi LoveConnect.");
            setTimeout(() => location.reload(), 1000); 
        }

        // --- 2. Profile Logic ---
        function previewPhoto(event) {
            const reader = new FileReader();
            reader.onload = function(){
                const src = reader.result;
                document.getElementById('profile-photo-display').src = src;
                document.getElementById('home-avatar').src = src;
            }
            reader.readAsDataURL(event.target.files[0]);
        }

        function saveProfile() {
            const name = document.getElementById('p-name').value;
            const hometown = document.getElementById('p-hometown').value;
            const hobby = document.getElementById('p-hobby').value;
            
            document.getElementById('home-user-name').textContent = name;
            document.getElementById('home-user-hometown').textContent = `Qu√™ qu√°n: ${hometown}`;
            document.getElementById('home-user-hobby').textContent = `S·ªü th√≠ch: ${hobby}`;
            
            showMessage('Th√†nh c√¥ng', 'H·ªì s∆° ƒë√£ ƒë∆∞·ª£c l∆∞u v√† c·∫≠p nh·∫≠t!');
        }
        
        // --- 3. Chat Logic ---
        
        function processMessage(message) {
            let processed = message;
            for (const key in ICONS) {
                const regex = new RegExp(key, 'g'); 
                processed = processed.replace(regex, ICONS[key]);
            }
            return processed;
        }

        function getPartnerResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            
            if (msg.includes('ch√†o') || msg.includes('kho·∫ª kh√¥ng')) {
                return "Ch√†o b·∫°n! M√¨nh kho·∫ª, c·∫£m ∆°n. B·∫°n th·∫ø n√†o? üòä";
            }
            if (msg.includes('r·∫£nh kh√¥ng') || msg.includes('g·∫∑p') || msg.includes('nh·∫Øn')) {
                return "M√¨nh r·∫£nh n√®. Ch√∫ng ta n√≥i chuy·ªán m·ªôt ch√∫t nh√©? üòâ";
            }
            if (msg.includes('s·ªü th√≠ch') || msg.includes('l√†m g√¨')) {
                return "M√¨nh ƒëang ƒë·ªçc s√°ch (m√≥n s·ªü th√≠ch c·ªßa m√¨nh ƒë√≥). C√≤n b·∫°n th√¨ sao?";
            }
            if (msg.includes('game') || msg.includes('ch∆°i')) {
                return "Tuy·ªát v·ªùi! Ch√∫ng ta ch∆°i game ƒêo√°n √ù ƒê·ªìng ƒê·ªôi nh√©? üéÆ";
            }
            if (msg.includes(':love:') || msg.includes('y√™u') || msg.includes('th√≠ch')) {
                return "M√¨nh c≈©ng r·∫•t qu√Ω m·∫øn b·∫°n! üíñ :kiss: C·∫£m ∆°n b·∫°n!";
            }
            if (msg.includes('bu·ªìn') || msg.includes(':cry:') || msg.includes(':sad:')) {
                return "C√≥ chuy·ªán g√¨ v·∫≠y? H√£y chia s·∫ª v·ªõi m√¨nh ƒëi. M√¨nh lu√¥n l·∫Øng nghe. üòî";
            }
            
            const defaultResponses = [
                "√Ä, m√¨nh hi·ªÉu r·ªìi. C·∫£m ∆°n b·∫°n ƒë√£ n√≥i cho m√¨nh bi·∫øt.",
                "Th·∫ø √†? Nghe c√≥ v·∫ª th√∫ v·ªã ƒë√≥!",
                "B·∫°n c√≥ mu·ªën chuy·ªÉn sang ch·ªß ƒë·ªÅ kh√°c kh√¥ng? :smile:",
                "M√¨nh r·∫•t vui khi tr√≤ chuy·ªán c√πng b·∫°n!",
                "Ch√†, ƒë√≥ l√† m·ªôt √Ω t∆∞·ªüng tuy·ªát v·ªùi!"
            ];
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }


        function sendChat() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (message === '') return;

            const messageArea = document.getElementById('messages-area');
            
            // 1. T·∫°o tin nh·∫Øn G·ª¨I (sent)
            const newMessage = document.createElement('div');
            newMessage.classList.add('message-bubble', 'sent');
            newMessage.innerHTML = processMessage(message);
            
            messageArea.appendChild(newMessage);
            
            lastUserMessage = message; 

            // 2. Cu·ªôn v√† x√≥a input
            messageArea.scrollTop = messageArea.scrollHeight; 
            input.value = '';

            // 3. M√¥ ph·ªèng tin nh·∫Øn PH·∫¢N H·ªíI (received) sau 1.5 gi√¢y
            setTimeout(() => {
                const partnerResponse = document.createElement('div');
                partnerResponse.classList.add('message-bubble', 'received');
                
                const responseText = getPartnerResponse(lastUserMessage);

                partnerResponse.innerHTML = processMessage(responseText);
                messageArea.appendChild(partnerResponse);
                messageArea.scrollTop = messageArea.scrollHeight;
            }, 1500);
        }
        
        function attachPhoto() {
            const messageArea = document.getElementById('messages-area');
            const photoMessage = document.createElement('div');
            
            photoMessage.classList.add('message-bubble', 'sent');
            photoMessage.innerHTML = '<img style="max-width: 150px; border-radius: 8px;" src="https://via.placeholder.com/150/F45B69/FFFFFF?text=H√¨nh+·∫£nh+ƒë√£+g·ª≠i" alt="H√¨nh ·∫£nh ƒë√£ g·ª≠i">';
            
            messageArea.appendChild(photoMessage);
            messageArea.scrollTop = messageArea.scrollHeight;
            
             setTimeout(() => {
                const partnerResponse = document.createElement('div');
                partnerResponse.classList.add('message-bubble', 'received');
                partnerResponse.innerHTML = "·∫¢nh n√†y ƒë·∫πp qu√°! üíñ B·∫°n ƒëang ·ªü ƒë√¢u v·∫≠y?";
                messageArea.appendChild(partnerResponse);
                messageArea.scrollTop = messageArea.scrollHeight;
            }, 1500);
        }

        function selectChat(partnerId) {
            document.getElementById('chat-header').textContent = `ƒêang tr√≤ chuy·ªán v·ªõi Ng∆∞·ªùi d√πng ${partnerId}`;
        }
        
        function openChat(partnerId) {
            selectChat(partnerId);
            showSection('chat');
        }

        // --- 4. Hi·ªáu ·ª©ng N·ªÅn ---
        function createHeart() {
            const heartBg = document.getElementById('heart-bg');
            const heart = document.createElement('div');
            heart.classList.add('heart');
            heart.textContent = HEARTS[Math.floor(Math.random() * HEARTS.length)];
            
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = Math.random() * 7 + 8 + 's';
            heart.style.fontSize = Math.random() * 20 + 20 + 'px';
            
            heartBg.appendChild(heart);
            setTimeout(() => { heart.remove(); }, 15000);
        }

        // --- 5. Logic K·ª∑ Ni·ªám (Countdown) ---
        function calculateDays(startDate) {
            const today = new Date();
            const start = new Date(startDate);
            today.setHours(0, 0, 0, 0);
            start.setHours(0, 0, 0, 0);
            const diffTime = today.getTime() - start.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            return diffDays;
        }

        function formatDate(dateString) {
            if (!dateString) return 'Ch∆∞a thi·∫øt l·∫≠p';
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function renderMilestones(startDate) {
            if (!startDate) {
                document.getElementById('milestones').innerHTML = '<p style="text-align: center; color: #888;">Vui l√≤ng thi·∫øt l·∫≠p ng√†y b·∫Øt ƒë·∫ßu y√™u!</p>';
                return;
            }

            const start = new Date(startDate);
            start.setHours(0, 0, 0, 0);

            const milestonesDiv = document.getElementById('milestones');
            milestonesDiv.innerHTML = '';
            const currentDays = calculateDays(startDate);

            const milestones = [
                { days: 100, label: '100 Ng√†y' }, { days: 200, label: '200 Ng√†y' },
                { days: 365, label: '1 NƒÉm' }, { days: 500, label: '500 Ng√†y' },
                { days: 730, label: '2 NƒÉm' }, { days: 1000, label: '1000 Ng√†y' }
            ];

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayTime = today.getTime();

            milestones.forEach(milestone => {
                const milestoneDate = new Date(start);
                milestoneDate.setDate(start.getDate() + milestone.days - 1); 

                const diffMs = milestoneDate.getTime() - todayTime;
                const daysUntil = Math.ceil(diffMs / (1000 * 60 * 60 * 24));
                const formattedDate = formatDate(milestoneDate);

                let statusClass = 'status-upcoming';
                let statusText = `C√≤n ${daysUntil} ng√†y`;

                if (daysUntil < 0) {
                    statusClass = 'status-passed';
                    statusText = 'ƒê√£ qua';
                } else if (daysUntil === 0) {
                    statusClass = 'status-today';
                    statusText = 'H√¥m nay!';
                }

                if (currentDays >= milestone.days && daysUntil !== 0) {
                    statusClass = 'status-passed';
                    statusText = 'ƒê√£ qua';
                }

                const milestoneItem = `
                    <div class="milestone-item">
                        <span style="font-size: 1.1em; color: var(--text-color);">${milestone.label}</span>
                        <span class="milestone-date">${formattedDate}</span>
                        <span class="milestone-status ${statusClass}">${statusText}</span>
                    </div>
                `;
                milestonesDiv.innerHTML += milestoneItem;
            });
        }

        function calculateDaysTogether() {
            const startDate = localStorage.getItem(DAYS_KEY);
            if (startDate) {
                const daysDiff = calculateDays(startDate);
                const dateString = formatDate(startDate);
                document.getElementById('days-together').innerHTML = `Ch√∫ng ta ƒë√£ quen nhau ƒë∆∞·ª£c <span style="font-size: 1.2em; font-weight: bold;">${daysDiff} ng√†y</span>! (T·ª´ ${dateString})`;
            } else {
                document.getElementById('days-together').innerHTML = `H√£y thi·∫øt l·∫≠p ng√†y y√™u ƒë·∫ßu ti√™n ·ªü m·ª•c <a href="#" onclick="showSection('remind')" style="color: var(--primary-color);">K·ª∑ Ni·ªám</a>!`;
            }
        }

        function loadDate() {
            const savedDate = localStorage.getItem(DAYS_KEY);
            if (savedDate) {
                connectionDate = savedDate;
                const daysCount = calculateDays(savedDate);
                document.getElementById('days-count').textContent = daysCount;
                document.getElementById('start-date-text').textContent = formatDate(savedDate);
                renderMilestones(savedDate);
                document.getElementById('start-date').value = savedDate; 
            } else {
                document.getElementById('days-count').textContent = '0';
                document.getElementById('start-date-text').textContent = 'Ch∆∞a thi·∫øt l·∫≠p';
                renderMilestones(null);
            }
        }

        function saveDate() {
            const inputDate = document.getElementById('start-date').value;
            if (inputDate) {
                const today = new Date().toISOString().slice(0, 10);
                
                if (inputDate > today) {
                    showMessage("L·ªói", "Ng√†y b·∫Øt ƒë·∫ßu y√™u kh√¥ng th·ªÉ ·ªü t∆∞∆°ng lai.");
                    return;
                }
                
                localStorage.setItem(DAYS_KEY, inputDate);
                showMessage("Th√†nh c√¥ng", `ƒê√£ l∆∞u ng√†y y√™u m·ªõi: ${formatDate(inputDate)}`);
                loadDate(); 
            } else {
                showMessage("L·ªói", "Vui l√≤ng ch·ªçn m·ªôt ng√†y h·ª£p l·ªá.");
            }
        }
        
        // --- 6. Logic Game Tic-Tac-Toe ---
        
        function initializeGame() {
            const boardElement = document.getElementById('tic-tac-toe-board');
            if (!boardElement) return;

            boardElement.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.dataset.index = i;
                cell.addEventListener('click', handleCellClick);
                boardElement.appendChild(cell);
            }
            // D√πng ID status m·ªõi
            updateStatus(`L∆∞·ª£t c·ªßa Ng∆∞·ªùi ch∆°i ${currentPlayer}`, 'var(--primary-color)', 'tictactoe-status'); 
            updateScoreDisplay();
        }

        function updateScoreDisplay() {
            if (document.getElementById('score-x')) {
                document.getElementById('score-x').textContent = scoreX;
                document.getElementById('score-o').textContent = scoreO;
            }
        }

        function updateStatus(message, color = 'var(--primary-color)', gameId = 'game-status') {
            const statusElement = document.getElementById(gameId);
            if (statusElement) {
                statusElement.innerHTML = message;
                statusElement.style.color = color;
            }
        }

        function handleCellClick(e) {
            const clickedCell = e.target;
            const clickedCellIndex = parseInt(clickedCell.dataset.index);

            if (board[clickedCellIndex] !== '' || !isGameActive) {
                return;
            }

            // 1. C·∫≠p nh·∫≠t tr·∫°ng th√°i game
            board[clickedCellIndex] = currentPlayer;
            clickedCell.innerHTML = currentPlayer;
            clickedCell.classList.add(currentPlayer.toLowerCase());

            // 2. Ki·ªÉm tra k·∫øt qu·∫£
            if (checkForWin()) {
                isGameActive = false;
                if (currentPlayer === 'X') {
                    scoreX++;
                    updateStatus(`Ng∆∞·ªùi ch∆°i X TH·∫ÆNG! üèÜ`, 'var(--heart-color)', 'tictactoe-status');
                } else {
                    scoreO++;
                    updateStatus(`Ng∆∞·ªùi ch∆°i O TH·∫ÆNG! üéâ`, '#4CAF50', 'tictactoe-status');
                }
                updateScoreDisplay();
                setTimeout(startNewRound, 2000); 
                return;
            }

            if (board.every(cell => cell !== '')) {
                isGameActive = false;
                updateStatus(`H√íA! Hai b·∫°n h√≤a nhau. ü§ù`, '#6c757d', 'tictactoe-status');
                setTimeout(startNewRound, 2000); 
                return;
            }

            // 3. Chuy·ªÉn l∆∞·ª£t
            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updateStatus(`L∆∞·ª£t c·ªßa Ng∆∞·ªùi ch∆°i ${currentPlayer}`, 'var(--primary-color)', 'tictactoe-status');
        }

        function checkForWin() {
            for (let i = 0; i < WINNING_COMBOS.length; i++) {
                const [a, b, c] = WINNING_COMBOS[i];
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    document.querySelector(`[data-index="${a}"]`).style.backgroundColor = '#fce4ec';
                    document.querySelector(`[data-index="${b}"]`).style.backgroundColor = '#fce4ec';
                    document.querySelector(`[data-index="${c}"]`).style.backgroundColor = '#fce4ec';
                    return true;
                }
            }
            return false;
        }

        function startNewRound() {
            board = ['', '', '', '', '', '', '', '', ''];
            isGameActive = true;
            
            currentPlayer = (currentPlayer === 'X') ? 'O' : 'X'; 
            
            updateStatus(`L∆∞·ª£t c·ªßa Ng∆∞·ªùi ch∆°i ${currentPlayer}`, 'var(--primary-color)', 'tictactoe-status');
            initializeGame(); 
        }

        function resetGame(resetScores = false) {
            if (resetScores) {
                scoreX = 0;
                scoreO = 0;
                updateScoreDisplay();
            }
            currentPlayer = 'X'; 
            startNewRound();
            showMessage("Game ƒë√£ ƒë∆∞·ª£c Reset", "T·∫•t c·∫£ ƒëi·ªÉm s·ªë v√† tr·∫°ng th√°i game ƒë√£ ƒë∆∞·ª£c ƒë∆∞a v·ªÅ ban ƒë·∫ßu.");
        }
        
        // H√†m ph·ª• tr·ª£ cho c√°c game (ƒê√£ th√™m ·ªü b∆∞·ªõc tr∆∞·ªõc)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        
        // --- LOGIC 6 TR√í CH∆†I M·ªöI ---

        // Tr√≤ 1: V√≤ng quay T√¨nh Y√™u (Love Spinner)
        const SPINNER_ITEMS = [
            "H√¥n üíã", "√îm Th·∫≠t Ch·∫∑t ü§ó", "N√≥i 3 ƒêi·ªÅu Y√™u Th√≠ch ‚ù§Ô∏è", "M√°t-xa 5 Ph√∫t",
            "Vi·∫øt L·ªùi Y√™u", "H√°t M·ªôt B√†i H√°t üé∂", "K·ªÉ Chuy·ªán C∆∞·ªùi üòÇ", "L√™n K·∫ø Ho·∫°ch H·∫πn H√≤"
        ];
        let isSpinning = false;
        
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;

            const spinner = document.getElementById('spinner');
            const resultDiv = document.getElementById('spinner-result');

            const totalItems = SPINNER_ITEMS.length; 
            const degreePerItem = 360 / totalItems; 

            const randomIndex = Math.floor(Math.random() * totalItems);
            
            // Quay 5 v√≤ng + g√≥c ƒë√≠ch
            const targetDegree = 360 * 5 + (totalItems - randomIndex) * degreePerItem - degreePerItem / 2;
            
            spinner.style.transition = 'transform 5s cubic-bezier(0.1, 0.9, 0.4, 1)';
            spinner.style.transform = `rotate(${targetDegree}deg)`;
            
            resultDiv.textContent = 'ƒêang quay... Ch·ªù m·ªôt ch√∫t nh√©!';

            setTimeout(() => {
                isSpinning = false;
                const result = SPINNER_ITEMS[randomIndex];
                resultDiv.innerHTML = `**üéâ K·∫øt qu·∫£: ${result}**`;
                
                spinner.style.transition = 'none';
                spinner.style.transform = 'rotate(0deg)'; 
                setTimeout(() => {
                    spinner.style.transition = 'transform 5s cubic-bezier(0.1, 0.9, 0.4, 1)';
                }, 50);
            }, 5000); 
        }

        // Tr√≤ 2: ƒêo√°n √ù ƒê·ªìng ƒê·ªôi (Guess My Word)
        let secretWord = '';

        function setSecretWord() {
            const input = document.getElementById('secret-word-input');
            const word = input.value.trim().toLowerCase();
            if (word.length < 3) {
                showMessage('L·ªói', 'T·ª´ b√≠ m·∫≠t ph·∫£i c√≥ √≠t nh·∫•t 3 ch·ªØ c√°i.');
                return;
            }
            
            secretWord = word;
            
            input.style.display = 'none';
            document.querySelector('#guess-word button:first-of-type').style.display = 'none'; 
            document.getElementById('guesser-controls').style.display = 'block';
            document.getElementById('reset-guess').style.display = 'block';
            document.getElementById('word-length').textContent = secretWord.length;
            document.getElementById('guess-status').textContent = 'Ng∆∞·ªùi ch∆°i 2 (Partner) - B·∫Øt ƒë·∫ßu ƒêo√°n!';
            document.getElementById('guess-feedback').textContent = `G·ª£i √Ω: T·ª´ c√≥ ${secretWord.length} ch·ªØ c√°i.`;
            document.getElementById('guess-input').value = '';
        }

        function checkGuess() {
            const guessInput = document.getElementById('guess-input');
            const feedback = document.getElementById('guess-feedback');
            const guess = guessInput.value.trim().toLowerCase();

            if (guess === '') {
                feedback.textContent = 'Vui l√≤ng nh·∫≠p t·ª´ ƒëo√°n.';
                return;
            }

            if (guess === secretWord) {
                feedback.innerHTML = `**üéâ CH√öC M·ª™NG!** 'Ng∆∞·ªùi ch∆°i 2' ƒë√£ ƒëo√°n ƒë√∫ng t·ª´ **"${secretWord}"**!`;
                document.getElementById('guesser-controls').querySelector('button').disabled = true;
            } else {
                feedback.textContent = 'ƒêo√°n sai r·ªìi. Th·ª≠ l·∫°i nh√©! G·ª£i √Ω: ' + (guess.length > secretWord.length ? 'T·ª´ h∆°i d√†i.' : (guess.length < secretWord.length ? 'T·ª´ h∆°i ng·∫Øn.' : 'ƒê√∫ng s·ªë ch·ªØ c√°i.'));
                guessInput.value = '';
            }
        }

        function resetGuessGame() {
            secretWord = '';
            document.getElementById('secret-word-input').value = '';
            document.getElementById('secret-word-input').style.display = 'block';
            document.querySelector('#guess-word button:first-of-type').style.display = 'block'; 
            document.getElementById('guesser-controls').style.display = 'none';
            document.getElementById('reset-guess').style.display = 'none';
            document.getElementById('guess-status').textContent = 'Ng∆∞·ªùi ch∆°i 1 (B·∫°n) - ƒê·∫∑t t·ª´ b√≠ m·∫≠t.';
            document.getElementById('guess-feedback').textContent = '';
            document.getElementById('guesser-controls').querySelector('button').disabled = false;
        }


        // Tr√≤ 3: L·∫≠t Th·∫ª K·ª∑ Ni·ªám (Memory Match)
        const MEMORY_ICONS = ['üíñ', 'üòò', 'üíç', 'ü•Ç', 'üéÅ', 'üéÇ', 'üíå', 'üåü']; 
        let cardArray = [];
        let firstCard = null;
        let secondCard = null;
        let lockBoard = false;
        let flips = 0;
        let matchedPairs = 0;

        function initializeMemoryGame() {
            cardArray = [...MEMORY_ICONS, ...MEMORY_ICONS]; 
            shuffleArray(cardArray);

            const board = document.getElementById('memory-board');
            if (!board) return;
            board.innerHTML = '';
            
            firstCard = null;
            secondCard = null;
            lockBoard = false;
            flips = 0;
            matchedPairs = 0;
            document.getElementById('memory-flips').textContent = flips;
            document.getElementById('memory-matched').textContent = matchedPairs;
            
            cardArray.forEach((icon, index) => {
                const card = document.createElement('div');
                card.classList.add('memory-card');
                card.dataset.icon = icon;
                card.dataset.index = index;
                card.innerHTML = `
                    <div class="card-face card-front">Love</div>
                    <div class="card-face card-back">${icon}</div>
                `;
                card.addEventListener('click', flipCard);
                board.appendChild(card);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;

            this.classList.add('flipped');
            flips++;
            document.getElementById('memory-flips').textContent = flips;

            if (!firstCard) {
                firstCard = this;
                return;
            }

            secondCard = this;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.icon === secondCard.dataset.icon;

            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            matchedPairs++;
            document.getElementById('memory-matched').textContent = matchedPairs;
            
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');
            
            firstCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('click', flipCard);

            resetBoard();
            
            if (matchedPairs === MEMORY_ICONS.length) {
                showMessage('Th·∫Øng!', `Ch√∫c m·ª´ng! B·∫°n ƒë√£ t√¨m th·∫•y t·∫•t c·∫£ ${MEMORY_ICONS.length} c·∫∑p v·ªõi ${flips} l·∫ßn l·∫≠t!`);
            }
        }

        function unflipCards() {
            lockBoard = true;

            setTimeout(() => {
                firstCard.classList.remove('flipped');
                secondCard.classList.remove('flipped');
                resetBoard();
            }, 1200);
        }

        function resetBoard() {
            [firstCard, secondCard, lockBoard] = [null, null, false];
        }

        // Tr√≤ 4: X√∫c X·∫Øc Quy·∫øt ƒê·ªãnh H·∫πn H√≤ (Date Night Dice)
        const DATE_OPTIONS = [
            'N·∫•u ƒÉn c√πng nhau üçú', 'Xem phim t·∫°i nh√† üé¨', 'ƒêi d·∫°o c√¥ng vi√™n üå≥',
            'ThƒÉm b·∫£o t√†ng/tri·ªÉn l√£m üñºÔ∏è', 'T·ªëi h·∫πn h√≤ l√£ng m·∫°n ·ªü nh√† h√†ng ü•Ç', 'ƒêi u·ªëng c√† ph√™/tr√† s·ªØa ‚òï'
        ];

        function rollDice() {
            const diceDisplay = document.getElementById('dice-display');
            const resultDiv = document.getElementById('dice-result');
            
            diceDisplay.textContent = '...';
            resultDiv.textContent = 'ƒêang tung x√∫c x·∫Øc...';
            
            setTimeout(() => {
                const roll = Math.floor(Math.random() * DATE_OPTIONS.length);
                const result = DATE_OPTIONS[roll];
                
                diceDisplay.textContent = 'üé≤'; 
                resultDiv.innerHTML = `**Bu·ªïi H·∫πn H√≤ Tuy·ªát V·ªùi: ${result}**`;
            }, 1000);
        }
        
        // Tr√≤ 5: H·ªôp H·ªèi ƒê√°p T√¨nh Y√™u (Love Q&A Box)
        const LOVE_ANSWERS = [
            "C√≥, ch·∫Øc ch·∫Øn r·ªìi! üíñ",
            "Kh√¥ng, h√£y nghƒ© l·∫°i th·∫≠t k·ªπ.",
            "T√¨nh y√™u s·∫Ω ƒë·∫øn khi b·∫°n √≠t mong ƒë·ª£i nh·∫•t.",
            "Ph·∫£i, v≈© tr·ª• ƒëang ·ªßng h·ªô b·∫°n.",
            "Ch·ªâ c·∫ßn ki√™n nh·∫´n m·ªôt ch√∫t.",
            "Kh√¥ng th·ªÉ d·ª± ƒëo√°n ƒë∆∞·ª£c, h√£y h√†nh ƒë·ªông!",
            "R·∫•t c√≥ th·ªÉ l√† c√≥.",
            "H√£y h·ªèi tr√°i tim b·∫°n, n√≥ bi·∫øt c√¢u tr·∫£ l·ªùi.",
            "ƒêi·ªÅu ƒë√≥ ph·ª• thu·ªôc v√†o n·ªó l·ª±c c·ªßa c·∫£ hai.",
            "C√¢u tr·∫£ l·ªùi n·∫±m trong n·ª• c∆∞·ªùi c·ªßa ƒë·ªëi ph∆∞∆°ng. üòä"
        ];

        function getLoveAnswer() {
            const questionInput = document.getElementById('qa-input');
            const answerDiv = document.getElementById('answer-display');
            const question = questionInput.value.trim();

            if (question.length < 5 || !question.includes('?')) {
                answerDiv.textContent = 'Vui l√≤ng ƒë·∫∑t m·ªôt c√¢u h·ªèi t√¨nh y√™u h·ª£p l·ªá (c√≥ d·∫•u "?").';
                return;
            }

            answerDiv.innerHTML = 'üîÆ ƒêang t√¨m ki·∫øm c√¢u tr·∫£ l·ªùi...';
            
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * LOVE_ANSWERS.length);
                answerDiv.textContent = LOVE_ANSWERS[randomIndex];
            }, 1500);
        }
        
        // Tr√≤ 6: X·∫øp H√¨nh Tr√°i Tim (Heart Jigsaw)
        const JIGSAW_PIECES = ['1', '2', '3', '4', '5', '6', '7', '8', '9']; // 9 m·∫£nh gh√©p
        let currentJigsawState = [...JIGSAW_PIECES];
        let moves = 0;

        function checkJigsawSolved() {
            return currentJigsawState.every((piece, index) => piece === JIGSAW_PIECES[index]);
        }

        function swapPieces(index1, index2) {
            [currentJigsawState[index1], currentJigsawState[index2]] = [currentJigsawState[index2], currentJigsawState[index1]];
            
            const board = document.getElementById('jigsaw-board');
            const piece1 = board.querySelector(`[data-index="${index1}"]`);
            const piece2 = board.querySelector(`[data-index="${index2}"]`);

            const tempPiece = piece1.dataset.piece;
            piece1.dataset.piece = piece2.dataset.piece;
            piece2.dataset.piece = tempPiece;
            
            piece1.textContent = piece1.dataset.piece;
            piece2.textContent = piece2.dataset.piece;

            piece1.classList.remove('selected');
            piece2.classList.remove('selected');
        }

        function handleJigsawClick(e) {
            const clickedPiece = e.target;
            const clickedIndex = parseInt(clickedPiece.dataset.index);

            if (checkJigsawSolved()) return; 

            clickedPiece.classList.toggle('selected');
            
            const selectedPieces = Array.from(document.querySelectorAll('.jigsaw-piece.selected'));

            if (selectedPieces.length === 2) {
                lockBoard = true; 
                moves++;
                document.getElementById('jigsaw-status').textContent = `S·ªë l·∫ßn di chuy·ªÉn: ${moves}`;

                const index1 = parseInt(selectedPieces[0].dataset.index);
                const index2 = parseInt(selectedPieces[1].dataset.index);

                swapPieces(index1, index2);

                setTimeout(() => {
                    lockBoard = false;
                    if (checkJigsawSolved()) {
                        document.querySelectorAll('.jigsaw-piece').forEach(p => p.classList.add('solved'));
                        document.getElementById('jigsaw-status').innerHTML = `**üéâ CH√öC M·ª™NG!** Tr√°i tim ƒë√£ ho√†n ch·ªânh sau **${moves}** l·∫ßn di chuy·ªÉn!`;
                    }
                }, 300); 

            } else if (selectedPieces.length > 2) {
                selectedPieces[0].classList.remove('selected');
                selectedPieces[1].classList.remove('selected');
            }
        }

        function initializeJigsawGame() {
            const board = document.getElementById('jigsaw-board');
            if (!board) return;
            board.innerHTML = '';
            
            moves = 0;
            document.getElementById('jigsaw-status').textContent = 'S·∫Øp x·∫øp ƒë·ªÉ t·∫°o ra: 1, 2, 3, 4, 5, 6, 7, 8, 9';
            
            const shuffledPieces = [...JIGSAW_PIECES];
            shuffleArray(shuffledPieces); 
            currentJigsawState = shuffledPieces;

            shuffledPieces.forEach((pieceValue, index) => {
                const piece = document.createElement('div');
                piece.classList.add('jigsaw-piece');
                piece.dataset.index = index; 
                piece.dataset.piece = pieceValue; 
                piece.textContent = pieceValue; 
                piece.classList.remove('solved', 'selected');
                piece.addEventListener('click', handleJigsawClick);
                board.appendChild(piece);
            });
        }
    </script>
</body>
</html>